#!/usr/bin/env python3

import pandas as pd
from cassandra.cluster import Cluster

data = pd.read_csv('/datasets/cassandra_practice_data/films/videos_by_tag_year.csv', error_bad_lines=False)

pi = "31415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963"
e = "27182818284590452353602874713526624977572470936999595749669676277240766303535475945713821785251664274274663919320030599218174135966290435729003342952605956307381323286279434907632338298807531952510190115738341879307021540891499348841675092447614606680822648001684774118537423454424371075390777449920695517027618386062613313845830007520449338265602976067371132007093287091274437470472306969772093101416928368190255151086574637721112523897844250569536967707854499699679468644549059879316368892300987931277361782154249992295763514822082698951936680331825288693984964651058209392398294887933203625094431173012381970684161403970198376793206832823764648042953118023287825098194558153017567173613320698112509961818815930416903515988885193458072738667385894228792284998920868058257492796104841984443634632"

cluster = Cluster(['mipt-node03'])
session = cluster.connect()
keyspace = 'msb202011keyspace'
session.execute("""CREATE KEYSPACE IF NOT EXISTS %s WITH replication = { 
'class': 'SimpleStrategy', 'replication_factor': '3' }""" % keyspace)
session.set_keyspace(keyspace)

session.execute("DROP TABLE IF EXISTS videos_metadata_hob202011")
session.execute("""
    CREATE TABLE IF NOT EXISTS videos_metadata_hob202011(
        tag text,
        added_year int,
        video_id int,
        added_date timestamp,
        description text,
        title text,
        user_id int,
        PRIMARY KEY(tag, user_id)
    )
""")

for idx, row in data.iterrows():
    session.execute("INSERT INTO videos_metadata_hob202011 (tag, added_year, video_id, added_date, description, title, user_id) VALUES (%s, %s, %s, %s, %s, %s, %s)", 
            (row[0], row[1], idx * int(pi[idx]), row[3], str(row[4]).replace('\'', ""), row[5], idx * int(e[idx])))
