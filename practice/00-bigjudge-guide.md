## Подготовка кода для сдачи
Для каждой домашки имеются предваритиельно созданные репозитории с веткой master и ветками для каждой задачи в домашке. Для сдачи домашки нужно:
1. В каждой ветке в корень положить файл `.gitlab-ci.yml` такого содержания:
```yml
job1:
  except:
    - master
  script:
    - date
    - if [ `grep -v '#' ${CI_COMMIT_REF_NAME}/run.sh | wc -l` -gt 0 ]; then (cd ~/code; ./gitlab_ci_runner.py); else exit 1; fi
```
(можно взять [отсюда](http://gitlab.atp-fivt.org/root/demos/blob/ci_files/.gitlab-ci.yml))

2. В каждой ветке создать директорию, имя директории = имени ветки. Например, для ДЗ по MapReduce нужно создать директории с названиями `mapreducetask1` и `mapreducetask2` в ветках `mapreducetask1` и `mapreducetask2` соотвественно.

3. В созданных директориях положите файл `run.sh`. Это точка входа в вашу программу и именно её будет запускать система проверки. В `run.sh` может быть как всё решение задачи так и вызов других файлов.

4. В задачах по MapReduce убедитесь что в выводе присуствует:
 * **stderr** с логами Hadoop (в противном случае система будет думать что вы делаете задачу на обычном bash / python)
 * в **stdout** должен выводиться только результат работы программы и ничего больше. Поэтому весь лишний вывод нужно перенаправить в /dev/null.

Пример того, что перенаправлять можно посмотреть [здесь](http://gitlab.atp-fivt.org/root/demos/blob/master/run.sh).

## Просмотр логов тестирующей инфраструктуры
Во время тестирования ваш код запускается на другом Hadoop кластере чтоб не грузить основную очередь.

### Простой способ
1. Заходим на тестирующий кластер:
```bash
ssh bigtest@mipt-client.atp-fivt.org -L 10000:mipt-master:8088 -L 10001:mipt-master:18089 -L 10002:mipt-master:19888
password: c3gR1E2PgadnU6MBBWAI
```
2. Открываем в браузере `localhost:<необходимый_порт>`.

### Продвинутый способ - proxy

1. Для Firefox удобно использовать плагин [FoxyProxy](https://addons.mozilla.org/ru/firefox/addon/foxyproxy-standard/). Использовать нужно именно версию Standard, базовая (Basic) работать не будет. После подключения расширения, конфигурируем его таким образом:
<img src="/practice/images/foxy.png"  width="480" height="360">

2. Заходим на тестирующий кластер:
```bash
ssh bigtest@mipt-client.atp-fivt.org -D 1234
password: c3gR1E2PgadnU6MBBWAI
```

3. Все UI будут доступны по ссылке: `http://mipt-master.atp-fivt.org:<PORT>`.

Данный способ проводит весь трафик через сервер поэтому когда используете прокси, закрывайте остальные вкладки.

### FAQ
1. Бывает, что при подключении пишет:
```
bind: Address already in use
channel_setup_fwd_listener: cannot listen to port: 1234
Could not request local forwarding.
```

Это значит, что вы открыли 2 соединения на порту 1234 одновременно. В таком случае можно добавить в Firefox ещё одну прокси-запись или ещё один proxy-server в Chrome (например с портом 1235). А проще всего - закрыть одну из прокси-сессий. Для решения задач врядли понадобится держать оба UI открытыми постоянно.

2. Если вместо открытия страницы выводятся ошибки типа SSL_ERROR_RX_RECORD_TOO_LONG или ERR_SSL_PROTOCOL_ERROR, убедитесь что ваш браузер не заменяет http на https в ссылках. Если такая замена происходит - почитите кеш или перейдите в режим инкогнито.

3. Замечу также, что на тестирующем кластере система запускает задачи под одним пользователем. Поэтому если вы не будете давать своим Job'ами уникальные имена (см. примеры из семинаров), найти свою задачу будет невозможно.

Подробнее про работу системы см. [ЗДЕСЬ](https://docs.google.com/presentation/d/1eDxnTeBWSB1OrA3BwEUa2vJAJm3_OJMuoRxyA13RzTY/edit#slide=id.p).
